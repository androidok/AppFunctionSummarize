define("common:widget/userbar-renew/userbar-renew.js",function(e){function t(){n("#userbar-login").click(function(e){try{s.fire("login.check"),e.preventDefault()}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common:widget/userbar-renew/userbar-renew.js",method:"",ln:43})}});var e=n("#userbar-reg");if(e.length){var t=e.attr("href")+encodeURIComponent(window.location.href);e.attr("href",t)}n("#userbar-logout").attr("href","//passport.baidu.com/?logout&aid=7&u="+escape(location.href)).mousedown(function(){i.send({url:location.href,type:"2046",action:"logout"})});var o=n("#no-username-set").click(function(e){try{s.fire("login.setUsername"),e.preventDefault()}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common:widget/userbar-renew/userbar-renew.js",method:"",ln:71})}});o.length&&i.send({type:2030,pv_from:"usrbar"}),new a("user-name","username-sublist",{left:10,right:0})}function o(){F.context("user");n.ajax({url:"/ichat/api/chatlist",type:"GET",dataType:"json"}).done(function(e){if(!(e.errno>0||!e.data||0==(e.data.book&&e.data.book.unreadCount)&&0==(e.data.recent&&e.data.recent.unreadCount))){var t=0;e.data.book&&e.data.book.unreadCount>0&&(t+=e.data.book.unreadCount),e.data.recent&&e.data.recent.unreadCount>0&&(t+=e.data.recent.unreadCount);var o=0==t?" ":'<strong class="orange-num">('+t+")</strong>";n("#baidu-msg").html('<a title="\u79c1\u4fe1" href="/ichat/chatlist" target="_blank">\u79c1\u4fe1'+o+"</a>"),s.fire("userbar.reposition",{waiting:!1});var a="";if(e.data.book&&e.data.book.unreadCount>0){for(var i,r=0;i=e.data.book.list[r];r++)if(i.unreadCount>0){a=i.uname+" \u7ed9\u4f60\u53d1\u4e86\u79c1\u4fe1";break}}else if(e.data.recent&&e.data.recent.unreadCount>0)for(var i,r=0;i=e.data.recent.list[r];r++)if(i.unreadCount>0){a=i.uname+" \u7ed9\u4f60\u53d1\u4e86\u4e00\u6761\u79c1\u4fe1";break}a.length>0&&(n("body").hasClass("zhidao-index")?setTimeout(function(){n("body").append('<div class="zhidao-new-message-tip">'+a+'<span class="close"></span><span class="trangle"></span></div>'),n(".zhidao-new-message-tip").css({right:n("body").width()-n("#baidu-msg").offset().left-45,top:n("#baidu-msg").offset().top+32}).on("click",".close",function(e){try{e.preventDefault(),n(".zhidao-new-message-tip").remove()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"common:widget/userbar-renew/userbar-renew.js",method:"",ln:154})}})},500):setTimeout(function(){n("body").append('<div class="zhidao-new-message-tip">'+a+'<span class="close"></span><span class="trangle"></span></div>'),n(".zhidao-new-message-tip").css({right:n("body").width()-n("#baidu-msg").offset().left-40,top:43,"z-index":998}).on("click",".close",function(e){try{e.preventDefault(),n(".zhidao-new-message-tip").remove()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"common:widget/userbar-renew/userbar-renew.js",method:"",ln:166})}})},500))}})}function a(e,t,o){var a=this,i=n("#"+e),r=n("#"+t);a.timeout=0,i.mouseover(function(){clearTimeout(a.timeout);var e=(n(window).width(),n("#userbar").outerWidth(),n(this).position(),14);n.isNumber(o.right)&&(o.left=n("body").hasClass("zhidao-index")?(i.outerWidth()-16)/2+40+e:(i.outerWidth()-16)/2+40),r.css({left:o.left}).show(),s.fire("userbar.show",{waiting:!0})}).mouseout(function(){a.timeout=setTimeout(function(){r.hide(),clearTimeout(a.timeoutId),s.fire("userbar.hide",{waiting:!1})},100)}),r.mouseover(function(){clearTimeout(a.timeout),r.show(),s.fire("userbar.show",{waiting:!0})}).mouseout(function(){i.mouseout()}),r.find("li a").mouseover(function(){n(this).addClass("userbar-li-mover").parent().addClass("userbar-li-mover")}).mouseout(function(){n(this).removeClass("userbar-li-mover").parent().removeClass("userbar-li-mover")})}var n=e("common:widget/js/util/tangram/tangram.js"),s=e("common:widget/js/util/event/event.js"),i=(e("common:widget/js/logic/login/login.js"),e("common:widget/js/util/log/log.js")),r=e("common:widget/js/util/store/store.js");s.on("common.userbarMsgNum",function(e,t){t>99&&(t="99+");var o=n("#userbar-msg"),a=o.find(".orange-num");a.html(0==t?"<i></i>":"(<i>"+t+"</i>)")}),n(function(){"1"==F.context("user").isLogin?o():(r.remove("ikmsg_data"),r.remove("ikmsg_time"),n.cookie.remove("msgGuide",{path:"/"}),n.cookie.remove("msgGuideStep",{path:"/"}),n.cookie.get("IK_PASS")&&n.cookie.remove("IK_PASS",{path:"/"})),e.async("common:widget/js/logic/msg-new/msg-new.js",function(e){if(1==F.context("user").isLogin){var t=n("#userbar"),o=t.offset().left,a=n("#userbar #userbar-msg"),s=a.offset().left;e.init(n("body").hasClass("zhidao-index")?{position:{top:32,left:s-o-250+(n("#userbar-msg").width()+22)+20},commonUserbar:1}:{position:{top:43,left:s-o-275+(n("#userbar-msg").width()+14)+20,"z-index":999},commonUserbar:1})}else e.init();n("body").hasClass("zhidao-index")&&n(".lucky-try").css({top:8,right:5})})}),t(),n("#baidu-msg").on("click",function(e){try{i.send({page:"all",type:2060,action:"click",area:"baidu-msg"})}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common:widget/userbar-renew/userbar-renew.js",method:"",ln:344})}})});